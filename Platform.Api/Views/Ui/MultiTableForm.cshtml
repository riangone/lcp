@using Platform.Infrastructure.Definitions
@{
    var pageDef = (PageDefinition)ViewData["PageDef"]!;
    var pageName = (string)ViewData["PageName"]!;
    var currentLang = Context.Request.Query["lang"].FirstOrDefault() ?? ViewData["Lang"] as string ?? "en";

    var title = pageDef.Title ?? pageName;
    ViewData["Title"] = $"{title} - Low Code Platform";
    ViewData["ActivePage"] = "Page";
    ViewData["Lang"] = currentLang;
}

<div class="container mx-auto px-4 py-8">
    @* 页面标题 *@
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">@title</h1>
        @if (!string.IsNullOrEmpty(pageDef.Description))
        {
            <p class="text-gray-600">@pageDef.Description</p>
        }
    </div>

    @* 多表 CRUD 表单 - 支持新旧两种配置 *@
    @if (pageDef.FormSections != null && pageDef.FormSections.Any())
    {
        @* 新版配置格式 *@
        @await Html.PartialAsync("~/Views/Ui/_MultiTableFormNew.cshtml", pageDef)
    }
    else if (pageDef.MultiTableCrud != null)
    {
        @* 旧版配置格式 *@
        @await Html.PartialAsync("~/Views/Ui/_MultiTableFormLegacy.cshtml", pageDef)
    }
    else
    {
        <div class="text-center py-12">
            <i class="fas fa-exclamation-circle text-6xl text-gray-400 mb-4"></i>
            <p class="text-gray-600">此页面未配置多表 CRUD</p>
            <p class="text-sm text-gray-500 mt-2">
                FormSections: @(pageDef.FormSections == null ? "null" : pageDef.FormSections.Count.ToString())
            </p>
            <p class="text-sm text-gray-500">
                MultiTableCrud: @(pageDef.MultiTableCrud == null ? "null" : "configured")
            </p>
        </div>
    }
</div>
