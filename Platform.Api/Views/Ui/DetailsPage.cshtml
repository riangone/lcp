@using Platform.Infrastructure.Definitions
@model Dictionary<string, object>
@{
    var def = (ModelDefinition)ViewData["ModelDef"]!;
    var modelName = (string)ViewData["ModelName"]!;
    var row = (Dictionary<string, object>)ViewData["Row"]!;
    var returnUrl = ViewData["ReturnUrl"] as string;
    var project = Context.Request.Query["project"].FirstOrDefault() ?? "app";
    var backUrl = !string.IsNullOrWhiteSpace(returnUrl) ? returnUrl! : $"/ui/{modelName}?project={project}";

    var currentLang = Context.Request.Query["lang"].FirstOrDefault() ?? ViewData["Lang"] as string ?? "en";
    var uiLabels = def.Ui?.Labels;
    Dictionary<string, string>? localizedLabels = null;

    if (uiLabels != null)
    {
        if (currentLang == "zh" && uiLabels.Zh != null)
        {
            localizedLabels = uiLabels.Zh;
        }
        else if (currentLang == "en" && uiLabels.En != null)
        {
            localizedLabels = uiLabels.En;
        }
    }

    localizedLabels ??= new Dictionary<string, string>();
    var detailsLabel = localizedLabels.ContainsKey("details_button") ? localizedLabels["details_button"] : "Details";
    var title = localizedLabels.ContainsKey("title") ? localizedLabels["title"] : modelName;
    var backLabel = localizedLabels.ContainsKey("back_button") ? localizedLabels["back_button"] : "Back";
    var detailColumns = (def.List?.Columns?.Any() == true ? def.List.Columns : def.Columns);
    ViewData["Title"] = $"{detailsLabel} - {title}";
}

<div class="details-page-container">
  <div class="@def.Ui?.Styles?.CardClass">
    <div class="details-header">
      <h1 class="details-title">@detailsLabel - @title</h1>
      <a href="@backUrl" class="btn btn-outline">@backLabel</a>
    </div>

    <div class="details-content">
      <table class="details-table">
        <tbody>
          @foreach (var col in detailColumns)
          {
              var label = localizedLabels.ContainsKey(col) ? localizedLabels[col] : col;
              var value = row.ContainsKey(col) && row[col] != null ? row[col]!.ToString() : "";
              <tr>
                <th class="label">@label</th>
                <td class="value">@value</td>
              </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>

<style>
  .details-page-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }
  
  .details-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-light);
  }
  
  .details-title {
    margin: 0;
    font-size: var(--text-2xl);
    font-weight: 600;
    color: var(--text-primary);
  }
  
  .details-content {
    padding: 0.5rem 0;
  }
  
  .details-table {
    width: 100%;
    border-collapse: collapse;
  }
  
  .details-table th,
  .details-table td {
    padding: 0.875rem 1rem;
    text-align: left;
    border-bottom: 1px solid var(--border-light);
    font-size: var(--text-base);
  }
  
  .details-table th {
    width: 35%;
    font-weight: 600;
    color: var(--text-primary);
    background-color: var(--bg-secondary);
  }
  
  .details-table th.label {
    vertical-align: top;
  }
  
  .details-table td {
    color: var(--text-primary);
    word-break: break-word;
  }
  
  .details-table tr:last-child th,
  .details-table tr:last-child td {
    border-bottom: none;
  }
  
  .details-table tr:hover {
    background-color: var(--bg-secondary);
  }
</style>
