@{
    Layout = "_HmssLayout";
    ViewData["Title"] = "Master - 主数据管理";
    ViewData["Breadcrumb1"] = "Master";
}

<div class="hmss-master-page">
    @* 页面头部 *@
    <header class="master-header">
        <div class="header-content">
            <div class="header-branding">
                <div class="brand-icon">
                    <i class="bi bi-buildings-fill"></i>
                </div>
                <div class="brand-text">
                    <h1 class="page-title">Master</h1>
                    <p class="page-subtitle">主数据管理システム</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="user-info">
                    <span class="user-name"><i class="bi bi-person-circle"></i> @User.Identity?.Name</span>
                </div>
                <a href="/hmss/logout" class="btn btn-outline-light btn-sm">
                    <i class="bi bi-box-arrow-right"></i> 退出
                </a>
            </div>
        </div>
    </header>

    @* 快捷统计卡片 *@
    <section class="stats-section">
        <div class="stats-grid">
            <div class="stat-card stat-primary">
                <div class="stat-icon"><i class="bi bi-database"></i></div>
                <div class="stat-content">
                    <span class="stat-value" id="totalTables">-</span>
                    <span class="stat-label">数据表</span>
                </div>
            </div>
            <div class="stat-card stat-success">
                <div class="stat-icon"><i class="bi bi-check-circle"></i></div>
                <div class="stat-content">
                    <span class="stat-value">13</span>
                    <span class="stat-label">子系统</span>
                </div>
            </div>
            <div class="stat-card stat-warning">
                <div class="stat-icon"><i class="bi bi-clock-history"></i></div>
                <div class="stat-content">
                    <span class="stat-value" id="lastLogin">-</span>
                    <span class="stat-label">最后登录</span>
                </div>
            </div>
            <div class="stat-card stat-info">
                <div class="stat-icon"><i class="bi bi-gear"></i></div>
                <div class="stat-content">
                    <span class="stat-label">系统状态</span>
                    <span class="stat-status">运行中</span>
                </div>
            </div>
        </div>
    </section>

    @* 子系统导航 *@
    <section class="systems-section">
        <div class="section-header">
            <h2 class="section-title">
                <i class="bi bi-grid-3x3-gap-fill"></i>
                子系统导航
            </h2>
            <div class="section-actions">
                <div class="search-box">
                    <i class="bi bi-search"></i>
                    <input type="text" id="systemSearch" placeholder="搜索系统..." />
                </div>
            </div>
        </div>

        <div class="systems-grid" id="systemsGrid">
            @* 骨架屏加载 *@
            <div class="system-card skeleton">
                <div class="card-icon skeleton-icon"></div>
                <div class="card-title skeleton-text"></div>
                <div class="card-desc skeleton-text-short"></div>
            </div>
            <div class="system-card skeleton">
                <div class="card-icon skeleton-icon"></div>
                <div class="card-title skeleton-text"></div>
                <div class="card-desc skeleton-text-short"></div>
            </div>
            <div class="system-card skeleton">
                <div class="card-icon skeleton-icon"></div>
                <div class="card-title skeleton-text"></div>
                <div class="card-desc skeleton-text-short"></div>
            </div>
            <div class="system-card skeleton">
                <div class="card-icon skeleton-icon"></div>
                <div class="card-title skeleton-text"></div>
                <div class="card-desc skeleton-text-short"></div>
            </div>
        </div>
    </section>

    @* 快速访问链接 *@
    <section class="quick-links-section">
        <div class="section-header">
            <h2 class="section-title">
                <i class="bi bi-bookmark-fill"></i>
                快速访问
            </h2>
        </div>
        <div class="quick-links-grid">
            <a href="/ui/hmss/HmssUser?project=hmss" class="quick-link-card">
                <i class="bi bi-people-fill"></i>
                <span>用户管理</span>
            </a>
            <a href="/ui/hmss/HmssSystem?project=hmss" class="quick-link-card">
                <i class="bi bi-pc-display-horizontal"></i>
                <span>系统配置</span>
            </a>
            <a href="/hmss/tables?project=hmss" class="quick-link-card">
                <i class="bi bi-table"></i>
                <span>数据表管理</span>
            </a>
            <a href="/docs" class="quick-link-card">
                <i class="bi bi-file-earmark-text"></i>
                <span>API 文档</span>
            </a>
        </div>
    </section>
</div>

@section Styles {
<style>
    .hmss-master-page {
        padding: 24px;
        background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
        min-height: 100vh;
    }

    /* ========== 页面头部 ========== */
    .master-header {
        background: linear-gradient(135deg, #B00838 0%, #8B062C 100%);
        border-radius: 16px;
        padding: 24px 32px;
        margin-bottom: 24px;
        box-shadow: 0 4px 20px rgba(176, 8, 56, 0.3);
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .header-branding {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .brand-icon {
        width: 64px;
        height: 64px;
        border-radius: 16px;
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        color: white;
        backdrop-filter: blur(10px);
    }

    .brand-text .page-title {
        font-size: 32px;
        font-weight: 700;
        color: white;
        margin: 0;
        line-height: 1.2;
    }

    .brand-text .page-subtitle {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.8);
        margin: 4px 0 0 0;
    }

    .header-actions {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .user-info {
        color: white;
        font-size: 14px;
    }

    .user-name {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* ========== 统计卡片 ========== */
    .stats-section {
        margin-bottom: 24px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
    }

    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
    }

    .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
    }

    .stat-primary .stat-icon { background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); color: white; }
    .stat-success .stat-icon { background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%); color: white; }
    .stat-warning .stat-icon { background: linear-gradient(135deg, #ffc107 0%, #d39e00 100%); color: white; }
    .stat-info .stat-icon { background: linear-gradient(135deg, #17a2b8 0%, #117a8b 100%); color: white; }

    .stat-content {
        display: flex;
        flex-direction: column;
    }

    .stat-value {
        font-size: 24px;
        font-weight: 700;
        color: #212529;
    }

    .stat-label {
        font-size: 13px;
        color: #6c757d;
    }

    .stat-status {
        font-size: 13px;
        color: #28a745;
        font-weight: 600;
    }

    /* ========== 系统导航 ========== */
    .systems-section {
        background: white;
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
    }

    .section-title {
        font-size: 20px;
        font-weight: 700;
        color: #212529;
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 0;
    }

    .section-title i {
        color: #B00838;
    }

    .search-box {
        position: relative;
    }

    .search-box i {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
    }

    .search-box input {
        padding: 10px 16px 10px 40px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 14px;
        width: 250px;
        transition: border-color 0.3s ease;
    }

    .search-box input:focus {
        outline: none;
        border-color: #B00838;
    }

    .systems-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 20px;
    }

    .system-card {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 20px;
        text-decoration: none;
        color: inherit;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .system-card:hover {
        border-color: #B00838;
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(176, 8, 56, 0.15);
    }

    .card-icon {
        width: 60px;
        height: 60px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        margin-bottom: 14px;
        background: linear-gradient(135deg, #B00838 0%, #8B062C 100%);
        color: white;
        transition: transform 0.3s ease;
    }

    .system-card:hover .card-icon {
        transform: scale(1.1);
    }

    .card-title {
        font-size: 16px;
        font-weight: 600;
        color: #212529;
        margin-bottom: 4px;
    }

    .card-desc {
        font-size: 12px;
        color: #6c757d;
        margin: 0;
    }

    /* 系统卡片颜色变体 */
    .system-card[data-sys="SDH"] .card-icon { background: linear-gradient(135deg, #00A8E0 0%, #0077A3 100%); }
    .system-card[data-sys="HDKAIKEI"] .card-icon { background: linear-gradient(135deg, #28A745 0%, #1E7E34 100%); }
    .system-card[data-sys="HMHRMS"] .card-icon { background: linear-gradient(135deg, #6F42C1 0%, #563D7C 100%); }
    .system-card[data-sys="JKSYS"] .card-icon { background: linear-gradient(135deg, #FD7E14 0%, #E8590C 100%); }
    .system-card[data-sys="R4"] .card-icon { background: linear-gradient(135deg, #20c997 0%, #198754 100%); }
    .system-card[data-sys="HMAUD"] .card-icon { background: linear-gradient(135deg, #dc3545 0%, #a71d2a 100%); }
    .system-card[data-sys="HMDPS"] .card-icon { background: linear-gradient(135deg, #fd7e14 0%, #ca620e 100%); }
    .system-card[data-sys="HMTVE"] .card-icon { background: linear-gradient(135deg, #e83e8c 0%, #b52a6e 100%); }
    .system-card[data-sys="APPM"] .card-icon { background: linear-gradient(135deg, #6610f2 0%, #4d0cc4 100%); }
    .system-card[data-sys="PPRM"] .card-icon { background: linear-gradient(135deg, #17a2b8 0%, #117a8b 100%); }
    .system-card[data-sys="Login"] .card-icon { background: linear-gradient(135deg, #6c757d 0%, #545b62 100%); }
    .system-card[data-sys="CkChkzaiko"] .card-icon { background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%); }

    /* 骨架屏加载样式 */
    .skeleton {
        pointer-events: none;
    }

    .skeleton-icon {
        background: linear-gradient(90deg, #e9ecef 25%, #f8f9fa 50%, #e9ecef 75%);
        background-size: 200% 100%;
        animation: skeleton-pulse 1.5s infinite;
    }

    .skeleton-text {
        height: 20px;
        width: 80%;
        background: linear-gradient(90deg, #e9ecef 25%, #f8f9fa 50%, #e9ecef 75%);
        background-size: 200% 100%;
        animation: skeleton-pulse 1.5s infinite;
        border-radius: 4px;
        margin: 0 auto;
    }

    .skeleton-text-short {
        height: 14px;
        width: 50%;
        background: linear-gradient(90deg, #e9ecef 25%, #f8f9fa 50%, #e9ecef 75%);
        background-size: 200% 100%;
        animation: skeleton-pulse 1.5s infinite;
        border-radius: 4px;
        margin: 4px auto 0;
    }

    @@keyframes skeleton-pulse {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }

    /* ========== 快速访问链接 ========== */
    .quick-links-section {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
    }

    .quick-links-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 16px;
        margin-top: 16px;
    }

    .quick-link-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        padding: 20px;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 12px;
        text-decoration: none;
        color: #212529;
        transition: all 0.3s ease;
    }

    .quick-link-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
    }

    .quick-link-card i {
        font-size: 32px;
        color: #B00838;
    }

    .quick-link-card span {
        font-size: 13px;
        font-weight: 500;
    }

    /* ========== 响应式设计 ========== */
    @@media (max-width: 768px) {
        .hmss-master-page {
            padding: 16px;
        }

        .master-header {
            padding: 16px 20px;
        }

        .header-branding {
            gap: 12px;
        }

        .brand-icon {
            width: 48px;
            height: 48px;
            font-size: 24px;
        }

        .brand-text .page-title {
            font-size: 24px;
        }

        .header-actions {
            gap: 8px;
        }

        .user-info {
            display: none;
        }

        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .systems-grid {
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
        }

        .section-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
        }

        .search-box input {
            width: 100%;
        }

        .quick-links-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
</style>
}

@section Scripts {
<script>
    // 系统代码到中文名称的映射
    const systemNames = {
        'Master': '主数据管理',
        'Login': '登录认证',
        'HDKAIKEI': '会计传票',
        'HMAUD': '内部审计',
        'HMDPS': 'DPS 传票',
        'HMHRMS': '人力资源',
        'HMTVE': '数据汇总',
        'JKSYS': '人事給与',
        'R4': '管理会计',
        'SDH': '车检替代',
        'APPM': '广域应用',
        'PPRM': '无纸化',
        'CkChkzaiko': '库存确认'
    };

    // 加载系统列表
    async function loadSystems() {
        try {
            const response = await fetch('/api/hmss/systems');
            const result = await response.json();

            if (result.success) {
                renderSystems(result.data);
                updateStats(result.data.length);
            } else {
                showError('加载系统列表失败');
            }
        } catch (error) {
            console.error('Load systems error:', error);
            showError('网络错误');
        }
    }

    function renderSystems(systems) {
        const grid = document.getElementById('systemsGrid');

        if (!systems || systems.length === 0) {
            grid.innerHTML = '<div class="alert alert-info">暂无可用系统</div>';
            return;
        }

        grid.innerHTML = systems.map(sys => {
            const iconClass = sys.sys_icon || 'bi bi-box';
            // 修正链接：确保使用正确的 URL
            const url = sys.sys_url && sys.sys_url.startsWith('/') 
                ? sys.sys_url 
                : `/hmss/${sys.sys_cd.toLowerCase()}`;

            // 获取中文名称（如果有）
            const displayName = systemNames[sys.sys_cd] || sys.sys_nm;

            return `
                <a href="${url}?project=hmss" class="system-card" data-sys="${sys.sys_cd}">
                    <div class="card-icon">
                        <i class="bi ${iconClass}"></i>
                    </div>
                    <div class="card-title">${sys.sys_nm}</div>
                    <div class="card-desc">${displayName}</div>
                </a>
            `;
        }).join('');
    }

    function updateStats(systemCount) {
        document.getElementById('totalTables').textContent = '60+';
        
        // 显示当前时间作为最后登录
        const now = new Date();
        const timeStr = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
        document.getElementById('lastLogin').textContent = timeStr;
    }

    function showError(message) {
        const grid = document.getElementById('systemsGrid');
        grid.innerHTML = `
            <div class="alert alert-danger" role="alert" style="grid-column: 1/-1;">
                <i class="bi bi-exclamation-triangle-fill"></i>
                ${message}
            </div>
        `;
    }

    // 搜索功能
    function setupSearch() {
        const searchInput = document.getElementById('systemSearch');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                const keyword = e.target.value.toLowerCase();
                const cards = document.querySelectorAll('.system-card');
                
                cards.forEach(card => {
                    const title = card.querySelector('.card-title').textContent.toLowerCase();
                    const desc = card.querySelector('.card-desc').textContent.toLowerCase();
                    const matches = title.includes(keyword) || desc.includes(keyword);
                    card.style.display = matches ? 'flex' : 'none';
                });
            });
        }
    }

    // 页面加载时执行
    document.addEventListener('DOMContentLoaded', () => {
        loadSystems();
        setupSearch();
    });
</script>
}
