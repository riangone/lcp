@{
    Layout = "_HmssLayout";
    ViewData["Title"] = "Master";
    ViewData["Breadcrumb1"] = "Master";
}

<div class="hmss-page-header">
    <h1 class="page-title">
        <i class="bi bi-house-gear"></i>
        Master - 主数据管理
    </h1>
    <p class="page-subtitle">欢迎使用 HMSS 系统，请选择要访问的子系统</p>
    <div class="header-actions mt-3">
        <a href="/hmss/tables" class="btn btn-outline-primary">
            <i class="bi bi-database"></i>
            数据表管理
        </a>
    </div>
</div>

<div class="hmss-systems-grid">
    @* 系统卡片将在这里动态加载 *@
    <div class="systems-loading" id="systemsGrid">
        <div class="system-card skeleton">
            <div class="card-icon skeleton-icon"></div>
            <div class="card-title skeleton-text"></div>
            <div class="card-desc skeleton-text-short"></div>
        </div>
        <div class="system-card skeleton">
            <div class="card-icon skeleton-icon"></div>
            <div class="card-title skeleton-text"></div>
            <div class="card-desc skeleton-text-short"></div>
        </div>
        <div class="system-card skeleton">
            <div class="card-icon skeleton-icon"></div>
            <div class="card-title skeleton-text"></div>
            <div class="card-desc skeleton-text-short"></div>
        </div>
    </div>
</div>

@section Styles {
<style>
    .hmss-page-header {
        margin-bottom: 30px;
    }
    
    .page-title {
        font-size: 28px;
        font-weight: 700;
        color: #212529;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .page-title i {
        color: #B00838;
    }
    
    .page-subtitle {
        color: #6c757d;
        font-size: 15px;
        margin: 0;
    }
    
    .hmss-systems-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 24px;
    }
    
    .system-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        cursor: pointer;
        border: 2px solid transparent;
        text-decoration: none;
        color: inherit;
        display: block;
    }
    
    .system-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        border-color: #B00838;
    }
    
    .card-icon {
        width: 56px;
        height: 56px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        margin-bottom: 16px;
        background: linear-gradient(135deg, #B00838 0%, #8B062C 100%);
        color: white;
    }
    
    .card-title {
        font-size: 18px;
        font-weight: 600;
        color: #212529;
        margin-bottom: 8px;
    }
    
    .card-desc {
        font-size: 13px;
        color: #6c757d;
        margin: 0;
    }
    
    /* 骨架屏加载样式 */
    .skeleton {
        pointer-events: none;
    }
    
    .skeleton-icon {
        background: #e9ecef;
        animation: pulse 1.5s infinite;
    }
    
    .skeleton-text {
        height: 20px;
        background: #e9ecef;
        border-radius: 4px;
        animation: pulse 1.5s infinite;
    }

    .skeleton-text-short {
        height: 16px;
        width: 60%;
        background: #e9ecef;
        border-radius: 4px;
        animation: pulse 1.5s infinite;
    }
    
    /* 系统卡片颜色变体 */
    .system-card[data-sys="SDH"] .card-icon {
        background: linear-gradient(135deg, #00A8E0 0%, #0077A3 100%);
    }
    
    .system-card[data-sys="HDKAIKEI"] .card-icon {
        background: linear-gradient(135deg, #28A745 0%, #1E7E34 100%);
    }
    
    .system-card[data-sys="HMHRMS"] .card-icon {
        background: linear-gradient(135deg, #6F42C1 0%, #563D7C 100%);
    }
    
    .system-card[data-sys="JKSYS"] .card-icon {
        background: linear-gradient(135deg, #FD7E14 0%, #E8590C 100%);
    }
</style>
}

@section Scripts {
<script>
    // 加载系统列表
    async function loadSystems() {
        try {
            const response = await fetch('/api/hmss/systems');
            const result = await response.json();
            
            if (result.success) {
                renderSystems(result.data);
            } else {
                showError('加载系统列表失败');
            }
        } catch (error) {
            console.error('Load systems error:', error);
            showError('网络错误');
        }
    }
    
    function renderSystems(systems) {
        const grid = document.getElementById('systemsGrid');
        
        if (!systems || systems.length === 0) {
            grid.innerHTML = '<div class="alert alert-info">暂无可用系统</div>';
            return;
        }
        
        grid.innerHTML = systems.map(sys => {
            const iconClass = sys.sys_icon || 'bi bi-box';
            const url = sys.sys_url || `/hmss/${sys.sys_cd.toLowerCase()}`;
            
            return `
                <a href="${url}" class="system-card" data-sys="${sys.sys_cd}">
                    <div class="card-icon">
                        <i class="bi ${iconClass}"></i>
                    </div>
                    <div class="card-title">${sys.sys_nm}</div>
                    <div class="card-desc">${sys.sys_cd}</div>
                </a>
            `;
        }).join('');
    }
    
    function showError(message) {
        const grid = document.getElementById('systemsGrid');
        grid.innerHTML = `
            <div class="alert alert-danger" role="alert">
                <i class="bi bi-exclamation-triangle-fill"></i>
                ${message}
            </div>
        `;
    }
    
    // 页面加载时获取系统列表
    document.addEventListener('DOMContentLoaded', loadSystems);
</script>
}
