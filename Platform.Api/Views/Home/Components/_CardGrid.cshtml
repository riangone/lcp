@model Platform.Infrastructure.Definitions.CardGridConfig
@{
    var currentLang = Context.Request.Query["lang"].FirstOrDefault() ?? "en";
    var projectName = Context.Request.Query["project"].FirstOrDefault() ?? "app";
    var models = ViewData["Models"] as Dictionary<string, Platform.Infrastructure.Definitions.ModelDefinition>;
    var pages = ViewData["Pages"] as Dictionary<string, Platform.Infrastructure.Definitions.PageDefinition>;
}

@if (Model.Source == "models" && models != null && models.Any())
{
    <div class="container mx-auto px-4 pb-12">
        @if (!string.IsNullOrEmpty(Model.Title.GetText(currentLang)))
        {
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
                @Model.Title.GetText(currentLang)
            </h2>
        }

        <div class="grid grid-cols-1 sm:grid-cols-@Model.Columns.Tablet lg:grid-cols-@Model.Columns.Desktop xl:grid-cols-@Model.Columns.Wide gap-6">
            @foreach (var model in models)
            {
                var modelKey = model.Key;
                var uiLabels = model.Value.Ui?.Labels;
                var localizedLabels = currentLang == "zh" && uiLabels?.Zh != null ? uiLabels.Zh : uiLabels?.En;
                var title = localizedLabels?.ContainsKey("title") == true ? localizedLabels["title"] : modelKey;
                var icon = GetIconForModel(modelKey);
                var color = GetColorForModel(modelKey);
                
                // Ê£ÄÊü•ÊòØÂê¶Êúâ‰∏ìÁî® UI ÈÖçÁΩÆÔºåÂ¶ÇÊûúÊúâÂàôÊ∑ªÂä† ui=custom ÂèÇÊï∞
                var hasCustomView = model.Value.CustomView != null && model.Value.CustomView.Enabled && !string.IsNullOrEmpty(model.Value.CustomView.ListTemplate);
                var defaultUiMode = model.Value.CustomView?.DefaultUiMode ?? "custom";
                var href = hasCustomView && defaultUiMode == "custom" 
                    ? $"/ui/{modelKey}?project={projectName}&ui=custom" 
                    : $"/ui/{modelKey}?project={projectName}";

                <a href="@href" class="@Model.CardStyle.BaseClass @Model.CardStyle.HoverClass transition cursor-pointer">
                    <div class="text-center">
                        <div class="text-3xl mb-2">@icon</div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">@title</h3>
                        <p class="text-sm text-gray-500 mb-3">@((model.Value).Table)</p>
                        <span class="inline-block px-3 py-1 @color rounded-full text-xs font-medium">
                            @(currentLang == "zh" ? "ÁÆ°ÁêÜÊï∞ÊçÆ" : "Manage Data")
                        </span>
                    </div>
                </a>
            }
        </div>
    </div>
}
else if (Model.Source == "pages" && pages != null && pages.Any())
{
    <div class="container mx-auto px-4 pb-12">
        @if (!string.IsNullOrEmpty(Model.Title.GetText(currentLang)))
        {
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
                @Model.Title.GetText(currentLang)
            </h2>
        }

        <div class="grid grid-cols-1 sm:grid-cols-@Model.Columns.Tablet lg:grid-cols-@Model.Columns.Desktop gap-6">
            @foreach (var page in pages)
            {
                var pageKey = page.Key;
                var pageTitle = page.Value.Title ?? pageKey;
                var icon = "üîó";

                <a href="/page/@pageKey?project=@projectName" class="@Model.CardStyle.BaseClass @Model.CardStyle.HoverClass transition cursor-pointer">
                    <div class="text-center">
                        <div class="text-3xl mb-2">@icon</div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">@pageTitle</h3>
                        <p class="text-sm text-gray-500 mb-3">Â§öË°®È°µÈù¢</p>
                        <span class="inline-block px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-medium">
                            @(currentLang == "zh" ? "Â§öË°®ÁÆ°ÁêÜ" : "Multi-Table")
                        </span>
                    </div>
                </a>
            }
        </div>
    </div>
}
else if (Model.Source == "projects" && Model.Projects != null)
{
    <div class="container mx-auto px-4 pb-12">
        @if (!string.IsNullOrEmpty(Model.Title.GetText(currentLang)))
        {
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">
                @Model.Title.GetText(currentLang)
            </h2>
        }

        <div class="grid grid-cols-1 md:grid-cols-@Model.Columns.Tablet lg:grid-cols-@Model.Columns.Desktop gap-6 max-w-6xl mx-auto">
            @foreach (var project in Model.Projects)
            {
                var gradient = string.IsNullOrEmpty(project.Gradient) ? $"bg-gradient-to-br from-{project.Key}-500 to-{project.Key}-600" : $"bg-gradient-to-br {project.Gradient}";
                var isCurrent = projectName == project.Key;

                <a href="/?project=@project.Key" class="@Model.CardStyle.BaseClass @Model.CardStyle.HoverClass @gradient text-white transition cursor-pointer relative overflow-hidden group">
                    <!-- ËÉåÊôØË£ÖÈ•∞ -->
                    <div class="absolute inset-0 opacity-0 group-hover:opacity-20 transition-opacity duration-300">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-white rounded-full blur-2xl transform translate-x-16 -translate-y-16"></div>
                    </div>
                    
                    <div class="relative z-10">
                        <div class="flex items-start justify-between mb-4">
                            <div class="text-5xl">@project.Icon</div>
                            @if (isCurrent)
                            {
                                <span class="inline-block px-3 py-1 bg-white bg-opacity-30 rounded-full text-xs font-medium backdrop-blur-sm">
                                    ‚úÖ @(currentLang == "zh" ? "ÂΩìÂâçÈ°πÁõÆ" : "Current")
                                </span>
                            }
                        </div>
                        
                        <h3 class="text-2xl font-bold mb-2">@project.Name.GetText(currentLang)</h3>
                        <p class="text-white text-opacity-80 text-sm mb-4">@project.Description.GetText(currentLang)</p>
                        
                        @if (project.Features != null && project.Features.Any())
                        {
                            <div class="flex flex-wrap gap-2 mt-4">
                                @foreach (var feature in project.Features)
                                {
                                    <span class="px-3 py-1 bg-white bg-opacity-20 rounded-full text-xs backdrop-blur-sm">
                                        @feature
                                    </span>
                                }
                            </div>
                        }
                    </div>
                </a>
            }
        </div>
    </div>
}

@functions {
    string GetIconForModel(string modelName)
    {
        return modelName.ToLower() switch
        {
            "task" => "‚úÖ",
            "project" => "üìÅ",
            "customer" => "üë•",
            "contact" => "üìá",
            "opportunity" => "üí∞",
            "product" => "üì¶",
            "quote" => "üìÑ",
            "order" => "üõí",
            "artist" => "üé§",
            "album" => "üíø",
            "track" => "üéµ",
            _ => "üìä"
        };
    }

    string GetColorForModel(string modelName)
    {
        return modelName.ToLower() switch
        {
            "task" => "bg-blue-100 text-blue-700",
            "project" => "bg-green-100 text-green-700",
            "customer" => "bg-indigo-100 text-indigo-700",
            "opportunity" => "bg-orange-100 text-orange-700",
            "product" => "bg-purple-100 text-purple-700",
            _ => "bg-gray-100 text-gray-700"
        };
    }
}
