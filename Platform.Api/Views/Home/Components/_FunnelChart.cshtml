@model dynamic
@{
    var currentLang = Context.Request.Query["lang"].FirstOrDefault() ?? "en";
    var title = Model?.Title?.GetText(currentLang) ?? "";
    var subtitle = Model?.Subtitle?.GetText(currentLang) ?? "";
    var stages = Model?.Stages ?? [];
}

<div class="bg-white py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        @if (!string.IsNullOrEmpty(title))
        {
            <div class="text-center mb-8">
                <h3 class="text-2xl font-bold text-gray-800">@title</h3>
                @if (!string.IsNullOrEmpty(subtitle))
                {
                    <p class="text-gray-600 mt-2">@subtitle</p>
                }
            </div>
        }
        
        <div class="max-w-4xl mx-auto">
            @for (int i = 0; i < stages.Count; i++)
            {
                var stage = stages[i];
                var name = stage.Name.GetText(currentLang);
                var value = stage.Value?.ToString() ?? "0";
                var color = stage.Color?.ToString() ?? "bg-blue-500";
                
                // 计算宽度百分比（漏斗效果）
                var widthPercent = 100 - (i * 15);
                
                <div class="mb-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">@name</span>
                        <span class="text-sm font-bold text-gray-900">@value 个</span>
                    </div>
                    <div class="w-full bg-gray-100 rounded-full h-12 overflow-hidden">
                        <div class="@color h-full rounded-full transition-all duration-500 flex items-center justify-end pr-4" 
                             style="width: @widthPercent%">
                            <span class="text-white font-bold text-sm">@value</span>
                        </div>
                    </div>
                </div>
            }
        </div>
        
        <!-- 漏斗图例 -->
        <div class="mt-8 grid grid-cols-5 gap-4 max-w-4xl mx-auto">
            @foreach (var stage in stages)
            {
                var color = stage.Color?.ToString() ?? "bg-blue-500";
                <div class="text-center">
                    <div class="w-4 h-4 @color rounded-full mx-auto mb-1"></div>
                    <span class="text-xs text-gray-600">@stage.Name.GetText(currentLang)</span>
                </div>
            }
        </div>
    </div>
</div>
