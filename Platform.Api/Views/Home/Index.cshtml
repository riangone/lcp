@model Platform.Infrastructure.Definitions.HomeDefinition
@{
    ViewData["Title"] = Model?.Title ?? "LowCode Platform";
    ViewData["ActivePage"] = "Home";
    var currentLang = Context.Request.Query["lang"].FirstOrDefault() ?? "en";
}

<div class="min-h-screen">
    @if (Model?.Layout != null)
    {
        @foreach (var component in Model.Layout)
        {
            @await RenderComponentAsync(component.Type, component.Data)
        }
    }
    else
    {
        <!-- 默认布局：当没有 home.yaml 时使用 -->
        @await Html.PartialAsync("_DefaultHome")
    }
</div>

@functions {
    async Task RenderComponentAsync(string type, Dictionary<string, object> data)
    {
        var viewName = $"~/Views/Home/Components/_{type}.cshtml";
        
        try
        {
            @await Html.PartialAsync(viewName, data)
        }
        catch (Exception ex)
        {
            <div class="text-red-500 p-4">
                Component '@type' not found or failed to render: @ex.Message
            </div>
        }
    }
}
