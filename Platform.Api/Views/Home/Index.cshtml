@using Platform.Infrastructure.Definitions
@{
    var models = ViewData["Models"] as Dictionary<string, ModelDefinition>;
    // 获取当前语言，默认为英文
    var currentLang = Context.Request.Query["lang"].FirstOrDefault() ?? "en";
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Low Code Platform</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@@picocss/pico@2/css/pico.min.css" />
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>
<body>
    <main class="container">
        <header>
            <h1>Low Code Platform</h1>
            <p>Select a model to manage:</p>
            
            <!-- 语言切换 -->
            <select onchange="changeLanguage(this.value)" style="margin-top: 10px;">
                <option value="en" @(currentLang == "en" ? "selected" : "")>English</option>
                <option value="zh" @(currentLang == "zh" ? "selected" : "")>中文</option>
            </select>
        </header>

        <section>
            @if (models != null && models.Any())
            {
                <div class="grid" style="gap: 1rem;">
                    @foreach (var model in models)
                    {
                        var modelKey = model.Key; // 避免Razor解析错误
                        
                        // 获取UI配置
                        var uiLabels = model.Value.Ui?.Labels?.Languages;
                        var localizedLabels = uiLabels != null && uiLabels.ContainsKey(currentLang) ? uiLabels[currentLang] : new Dictionary<string, string>();
                        var title = localizedLabels.ContainsKey("title") ? localizedLabels["title"] : modelKey;
                        var description = localizedLabels.ContainsKey("description") ? localizedLabels["description"] : $"Manage {modelKey} records";
                        
                        var cardClass = model.Value.Ui?.Styles?.CardClass ?? "card";
                        var table = model.Value.Table;
                        
                        <a class="@cardClass" href="/ui/@modelKey?lang=@currentLang" style="text-decoration: none; padding: 1.5rem;">
                            <h3>@title</h3>
                            <p>@description</p>
                            <small>Table: @table</small>
                        </a>
                    }
                </div>
            }
            else
            {
                <p>No models defined.</p>
            }
        </section>

        <footer>
            <p><a href="/docs">API Documentation</a></p>
        </footer>
    </main>
    
    <script>
        function changeLanguage(lang) {
            const url = new URL(window.location);
            url.searchParams.set('lang', lang);
            window.location = url.toString();
        }
    </script>
</body>
</html>