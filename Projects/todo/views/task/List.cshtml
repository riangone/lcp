@using Platform.Infrastructure.Definitions
@model IEnumerable<Dictionary<string, object>>
@{
    var def = (ModelDefinition)ViewData["ModelDef"]!;
    var modelName = (string)ViewData["ModelName"]!;
    var pageNum = (int)ViewData["Page"]!;
    var size = (int)ViewData["Size"]!;
    var total = (int)ViewData["Total"]!;
    var currentLang = Context.Request.Query["lang"].FirstOrDefault() ?? "en";
    var currentProject = Context.Request.Query["project"].FirstOrDefault() ?? "todo";
    
    var localizedLabels = currentLang == "zh" ? def.Ui?.Labels?.Zh : def.Ui?.Labels?.En;
    var title = localizedLabels != null && localizedLabels.ContainsKey("title") ? localizedLabels["title"] : modelName;
    
    var statusConfig = new Dictionary<string, (string color, string icon, string label)>
    {
        { "pending", ("bg-amber-100 text-amber-700", "â³", currentLang == "zh" ? "å¾…å¤„ç†" : "Pending") },
        { "in_progress", ("bg-blue-100 text-blue-700", "ğŸ”„", currentLang == "zh" ? "è¿›è¡Œä¸­" : "In Progress") },
        { "completed", ("bg-emerald-100 text-emerald-700", "âœ…", currentLang == "zh" ? "å·²å®Œæˆ" : "Completed") }
    };
}

<div class="todo-app-container">
    <div class="todo-header">
        <h1 class="app-title"><span class="title-icon">ğŸ“‹</span> @title</h1>
        <div class="stats-bar">
            <div class="stat-badge stat-total"><span class="stat-number">@total</span><span class="stat-label">@(currentLang == "zh" ? "æ€»ä»»åŠ¡" : "Total")</span></div>
        </div>
    </div>

    <div class="todo-toolbar">
        <a href="/ui/Task/create?project=@currentProject" class="btn-new-task"><span class="btn-icon">â•</span> @(currentLang == "zh" ? "æ–°å»ºä»»åŠ¡" : "New Task")</a>
    </div>

    <div id="task-list" class="task-board">
        @foreach (var task in Model)
        {
            var id = task[def.PrimaryKey]?.ToString() ?? "";
            var titleText = task.ContainsKey("Title") ? task["Title"]?.ToString() ?? "" : "";
            var status = task.ContainsKey("Status") ? task["Status"]?.ToString() ?? "pending" : "pending";
            var statusInfo = statusConfig.ContainsKey(status) ? statusConfig[status] : statusConfig["pending"];
            
            <div class="task-card" data-id="@id" data-status="@status">
                <h3 class="task-title">@titleText</h3>
                <div class="task-meta">
                    <span class="task-status @status"><span class="status-icon">@statusInfo.icon</span><span class="status-label">@statusInfo.label</span></span>
                </div>
                <div class="task-actions">
                    <a href="/ui/Task/edit/@id?project=@currentProject" class="btn-action btn-edit">âœï¸</a>
                    <button class="btn-action btn-delete" onclick="openDeleteDialog('@modelName', '@id')">ğŸ—‘ï¸</button>
                </div>
            </div>
        }
        @if (!Model.Any())
        {
            <div class="empty-board"><div class="empty-icon">ğŸ“</div><h3>@(currentLang == "zh" ? "æš‚æ— ä»»åŠ¡" : "No tasks yet")</h3></div>
        }
    </div>
</div>

<style>
    .todo-app-container{max-width:1200px;margin:0 auto;padding:2rem;background:linear-gradient(135deg,#f0fdf4,#ecfdf5);min-height:100vh}
    .todo-header{background:linear-gradient(135deg,#059669,#10b981);border-radius:16px;padding:2rem;margin-bottom:2rem;box-shadow:0 10px 40px rgba(5,150,105,0.3)}
    .app-title{color:white;font-size:2rem;font-weight:700;display:flex;align-items:center;gap:0.75rem}
    .title-icon{font-size:2.5rem}
    .stats-bar{display:flex;gap:1rem;margin-top:1rem}
    .stat-badge{background:rgba(255,255,255,0.2);padding:0.75rem 1.25rem;border-radius:12px;text-align:center;color:white}
    .stat-number{display:block;font-size:1.75rem;font-weight:700}
    .stat-label{font-size:0.75rem;opacity:0.9}
    .todo-toolbar{background:white;border-radius:12px;padding:1.25rem;margin-bottom:1.5rem;box-shadow:0 4px 15px rgba(0,0,0,0.05)}
    .btn-new-task{background:linear-gradient(135deg,#10b981,#059669);color:white;padding:0.75rem 1.5rem;border-radius:10px;text-decoration:none;font-weight:600;display:inline-flex;align-items:center;gap:0.5rem}
    .task-board{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem}
    .task-card{background:white;border-radius:12px;padding:1.5rem;box-shadow:0 4px 15px rgba(0,0,0,0.05);border-left:4px solid #10b981}
    .task-card:hover{transform:translateY(-4px);box-shadow:0 12px 30px rgba(0,0,0,0.1)}
    .task-title{font-size:1.125rem;font-weight:600;color:#1f2937;margin-bottom:1rem}
    .task-meta{display:flex;gap:0.75rem;margin-bottom:1rem}
    .task-status{padding:0.375rem 0.75rem;border-radius:20px;font-size:0.75rem;font-weight:500;display:inline-flex;align-items:center;gap:0.375rem}
    .task-status.pending{background:#fef3c7;color:#92400e}
    .task-status.in_progress{background:#dbeafe;color:#1e40af}
    .task-status.completed{background:#d1fae5;color:#065f46}
    .task-actions{display:flex;gap:0.5rem}
    .btn-action{width:32px;height:32px;border-radius:8px;border:none;background:#f3f4f6;cursor:pointer;font-size:1rem}
    .btn-edit:hover{background:#3b82f6}
    .btn-delete:hover{background:#ef4444}
    .empty-board{text-align:center;padding:4rem;color:#9ca3af;grid-column:1/-1}
    .empty-icon{font-size:4rem;margin-bottom:1rem}
</style>
